<!DOCTYPE html>
<html>

<head lang="en">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script src="js/jquery.validate.js"></script>
    <script src="js/inputLimit.js" type="text/javascript"></script>
	<style>
		.error {
			color: red;
			text-align: right;
			margin-right: 10px;
		}
		
		.topForm {
			float: left;
			width: 300px;
			top: -2%;
			left: 5px;
		}
		
		.validFormDiv {
			float: left;
			width: 300px;
			top: 40%;
			left: 5px;
		}
		
		.sidebar span {
		    webkit-user-select:none;
	        user-select:none;
			width: 100px;
			padding: 5px;
			text-align: right;
		}
		
		.sidebar select {
			width: 155px;
		}
		.sidebar input {
			width: 155px;
		}
		textarea {
			resize: none;
			overflow-y: auto;
		}
	</style>
</head>

<body>
	<div class="contentDiv" id="contentDiv">
		<div class="bgDiv"></div>
		<div class="sidebar" style="height:550px">
			<div class="sidebarTitle" id="move" onmousedown="startMove(event,this.parentNode)" onmouseup="stopMove(event)">
				<span>修改RTU</span>
				<span class="sidebar_close"><img src="images/close.png" alt="close"/></span>
			</div>
			<div class="topForm">
				<p>
					<label for=""><span>RTU标识： </span></label>
					<input value="" id="alterRtuId" type="text" disabled/>
				</p>
				<p>
					<label for=""><span>RTU名称： </span></label>
					<input value="" id="alterRtuName" type="text" required/>
				</p>
			</div>
			<div class="bottomForm">
				<p>
					<label for="" id="module1Name"><span>模块1： </span></label>
					<select name="type" id="module1">
						<option value="0">--无--</option>
                        <option value="1">在纤模块</option>
                        <option value="2">备纤模块</option>
                        <option value="3">保护模块-主</option>
                        <option value="5">保护模块-从</option>
                        <option value="4">在纤OPM</option>
                    </select>
				</p>
				<p>
					<label for="" id="module2Name"><span>模块2： </span></label>
					<select name="type" id="module2">
						<option value="0">--无--</option>
                        <option value="1">在纤模块</option>
                        <option value="2">备纤模块</option>
                        <option value="3">保护模块-主</option>
                        <option value="5">保护模块-从</option>
                        <option value="4">在纤OPM</option>
                    </select>
				</p>
				<p>
					<label for="" id="module3Name"><span>模块3： </span></label>
					<select name="type" id="module3">
						<option value="0">--无--</option>
                        <option value="1">在纤模块</option>
                        <option value="2">备纤模块</option>
                        <option value="3">保护模块-主</option>
                        <option value="5">保护模块-从</option>
                        <option value="4">在纤OPM</option> 
                    </select>
				</p>
				<p>
					<label for="" id="module4Name"><span>模块4： </span></label>
					<select name="type" id="module4">
						<option value="0">--无--</option>
                        <option value="1">在纤模块</option>
                        <option value="2">备纤模块</option>
                        <option value="3">保护模块-主</option>
                        <option value="5">保护模块-从</option>
                        <option value="4">在纤OPM</option> 
                    </select>
				</p>
				<p>
					<label for="" id="module5Name"><span>模块5： </span></label>
					<select name="type" id="module5">
						<option value="0">--无--</option>
                        <option value="1">在纤模块</option>
                        <option value="2">备纤模块</option>
                        <option value="3">保护模块-主</option>
                        <option value="5">保护模块-从</option>
                        <option value="4">在纤OPM</option> 
                    </select>
				</p>
				<p>
					<label for="" id="module6Name"><span>模块6： </span></label>
					<select name="type" id="module6">
						<option value="0">--无--</option>
                        <option value="1">在纤模块</option>
                        <option value="2">备纤模块</option>
                        <option value="3">保护模块-主</option>
                        <option value="5">保护模块-从</option>
                        <option value="4">在纤OPM</option> 
                    </select>
				</p>
				<p>
					<label for="" id="module7Name"><span>模块7： </span></label>
					<select name="type" id="module7">
						<option value="0">--无--</option>
                        <option value="1">在纤模块</option>
                        <option value="2">备纤模块</option>
                        <option value="3">保护模块-主</option>
                        <option value="5">保护模块-从</option>
                        <option value="4">在纤OPM</option> 
                    </select>
				</p>
				<p>
					<label for="" id="module8Name"><span>模块8： </span></label>
					<select name="type" id="module8">
						<option value="0">--无--</option>
                        <option value="1">在纤模块</option>
                        <option value="2">备纤模块</option>
                        <option value="3">保护模块-主</option>
                        <option value="5">保护模块-从</option>
                        <option value="4">在纤OPM</option> 
                    </select>
				</p>
				<p>
					<label for=""><span>RTU描述： </span></label>
					<textarea name="" id="alterRtuDescription" cols="20" rows="6"></textarea>
				</p>
			</div>
			<div class="funcConfirm">
				<div class="callTestingFunc">
					 <span class="confirm spanbutton">确定</span>          <!--添加确定对应事件-->
                	 <span class="cancel spanbutton" style="margin-left:50px;">取消</span>
				</div>
			</div>
		</div>
	</div>

	<script>
    $(".sidebar_close").click(function(){
        $(".contentDiv").html("");
        $(".sidebarDiv").html("");
    });
    $(".cancel").click(function(){
    	 $(".contentDiv").html("");
         $(".sidebarDiv").html("");
    });
/***************************/    

    $(".confirm").click(function(){
		var alterRtuId=$("#alterRtuId").val();
    	var alterRtuName=$("#alterRtuName").val();
    	var alterRtuDescription=$("#alterRtuDescription").val();
    	//下面获取rtu的安装状态
        var module1 = $("#module1 option:selected").val();
        var module2 = $("#module2 option:selected").val();
        var module3 = $("#module3 option:selected").val();
        var module4 = $("#module4 option:selected").val();
        var module5 = $("#module5 option:selected").val();
        var module6 = $("#module6 option:selected").val();
        var module7 = $("#module7 option:selected").val();
        var module8 = $("#module8 option:selected").val();
        var installInfo =module1+module2+module3+module4+module5+module6+module7+module8;
    	$.ajax({
  			type : "post",
  			async : false,  //异步请求 先执行后续操作，再执行sucess
  			url : "rtu/modifyRtu",
  			dataType:'json',
  			data : {
  					'rtuType':dataBefore[7],
  					'alterRtuId':alterRtuId,
  					'alterRtuName':alterRtuName,
  					'alterRtuDescription':alterRtuDescription,
  					'installInfo':installInfo
                   },
  			success:function(json){
  				selectRtuByStation(dataBefore[6]);
  				var txt="";
			    if(json[0].status){
			    		txt+="修改成功<br/>"
			    		$(".sidebarDiv").html("");
			    	}
			    	else{
			    		txt+="修改失败，失败原因："+json[0].err;
			    	}
				     var option = {
								title: "提示",
								btn: parseInt("0001",2),
								onOk: function(){//点击确认的执行方法
								}
							}
					  window.wxc.xcConfirm(txt, "info", option);
			      },
			    error:function(XMLHttpRequest,Error)
			      {
			 		    var txt="修改失败<br/>";
			    	    txt+="失败原因：";
			    	    if(XMLHttpRequest.status==401){
			    	        txt+="您不具有当前操作的权限<br/>";
			    	     }
			    	     else{
			    	        	txt+="网络错误<br/>";
			    	        	txt+="状态码："+XMLHttpRequest.status;
			    	        }
			    	      var option={
			    	   					title: "提示",
			    	   					btn: parseInt("0001",2),
			    	   					onOk: function(){//点击确认的执行方法
			    	   						
			    	  			       }
			    	   				}
			    	     window.wxc.xcConfirm(txt, "info", option);
			  }
      	});
    });

/**************将原来的值作为修改框中的默认值***************/
var trs = document.querySelectorAll("#RTUTableDetail tbody tr");
 	    var dataBefore=[];
 	    for (var i=0;i<trs.length;i++){
 	        if($(trs[i]).hasClass("currtr")){
 	        	dataBefore = [trs[i].children[1].innerHTML,  //rtu标识
 	        	              trs[i].children[2].innerHTML,  //rtu名称
 	        	              trs[i].children[4].innerHTML,  //rtu激活码
 	        	              trs[i].children[5].innerHTML,  //rtu地址
 	        	              trs[i].children[6].innerHTML,  //rtu状态
 	        	              trs[i].children[9].innerHTML,  //rtu描述
 	        	              trs[i].children[7].innerHTML,  //局站的ID
 	        	              trs[i].children[3].innerHTML,  //rtu类型
 	        	              ];
 	        }
 	    }
	$("#alterRtuId").val(dataBefore[0]);
	$("#alterRtuName").val(dataBefore[1]);
	$("#alterRtuDescription").val(dataBefore[5]);
    if(dataBefore[7]=="普通rtu")
	{
	$.ajax({
		type : "post",
		async : false,  //异步请求 先执行后续操作，再执行sucess
		url : "getRtuInfoById",
		dataType:'json',
		data : {
				'rtuId':dataBefore[0],
           },
		success:function(json){
			$("#module1").val(json[0].installInfo[0]);
			$("#module2").val(json[0].installInfo[1]);
			$("#module3").val(json[0].installInfo[2]);
			$("#module4").val(json[0].installInfo[3]);
			$("#module5").val(json[0].installInfo[4]);
			$("#module6").val(json[0].installInfo[5]);
			$("#module7").val(json[0].installInfo[6]);
			$("#module8").val(json[0].installInfo[7]);
			for(var i=1;i<9;i++){
				var moduleId="#module"+i;
				if($(moduleId).val()!="0"){//原来已经设置的模块不能修改
					$(moduleId).attr("disabled","disabled");
				}
			}
	    },
	    
	  });
	}
else{
	var id="#module";
	for(var i=1;i<9;i++){
		$(id+i).css("display","none");
		$(id+i+"Name").css("display","none");
	}
	$(".sidebar").css("height","350px");
 }

var selects = document.getElementsByName("alterRtuStatus");  //指定选中radio的某一项
for (var i=0; i<selects.length; i++){  
    if (selects[i].value==dataBefore[4]) {  
        selects[i].checked= true;  
        break;  
    }  
}  

</script>
</body>

</html>